<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>주간보고 제출</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .project-section {
      margin: 1rem 0;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
    }
  </style>
  <script>
    function toggleProjectSections() {
      const selectedOptions = Array.from(document.getElementById('project_ids').selectedOptions).map(o => o.value);
      document.querySelectorAll('.project-section').forEach(div => {
        div.style.display = selectedOptions.includes(div.dataset.projectId) ? 'block' : 'none';
      });
    }
  </script>
</head>
<body>
  <h1>주간보고 제출</h1>
  <form method="POST" action="{{ url_for('submit') }}">
    <label for="employee_id">글로벌 사번:</label>
    <input type="text" name="employee_id" id="employee_id" required><br><br>

    <label for="week">주차:</label>
    <select name="week" id="week">
      {% for i in range(1, 53) %}
        <option value="Y25W{{ "%02d"|format(i) }}">Y25W{{ "%02d"|format(i) }}</option>
      {% endfor %}
    </select><br><br>

    <label for="project_ids">보고할 프로젝트 선택 (다중선택 가능):</label><br>
    <select id="project_ids" name="project_ids" multiple onchange="toggleProjectSections()" size="5" style="width: 300px;">
      {% for project in projects %}
        <option value="{{ project.id }}">{{ project.solution_name }} / {{ project.project_name }} / {{ project.code }}</option>
      {% endfor %}
    </select><br><br>

    {% for project in projects %}
      <div class="project-section" data-project-id="{{ project.id }}" style="display:none;">
        <h3>{{ project.solution_name }} / {{ project.project_name }} ({{ project.code }})</h3>
        <input type="hidden" name="project_{{ project.id }}_id" value="{{ project.id }}">

        <label>진행상황:</label><br>
        <textarea name="project_{{ project.id }}_progress" rows="3" style="width:100%;"></textarea><br>

        <label>특이사항:</label><br>
        <textarea name="project_{{ project.id }}_issues" rows="3" style="width:100%;"></textarea><br>

        <label>영업지원 사항:</label><br>
        <textarea name="project_{{ project.id }}_sales_support" rows="2" style="width:100%;"></textarea><br>

        <label>그 외 특이사항:</label><br>
        <textarea name="project_{{ project.id }}_other_notes" rows="2" style="width:100%;"></textarea><br>

        <label>출장:</label><br>
        <textarea name="project_{{ project.id }}_business_trip" rows="2" style="width:100%;"></textarea><br>

        <label>외근:</label><br>
        <textarea name="project_{{ project.id }}_external_work" rows="2" style="width:100%;"></textarea><br>

        <label>휴가:</label><br>
        <textarea name="project_{{ project.id }}_vacation" rows="2" style="width:100%;"></textarea><br>

        <label>휴일근무:</label><br>
        <textarea name="project_{{ project.id }}_weekend_work" rows="2" style="width:100%;"></textarea><br>
      </div>
    {% endfor %}

    <button type="submit">제출</button>
  </form>
</body>
</html>
