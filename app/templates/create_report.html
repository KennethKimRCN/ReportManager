{% extends 'base.html' %}
{% block title %}ë³´ê³ ì„œ ì‘ì„±{% endblock %}

{% block content %}
<h2>ğŸ“ ì£¼ê°„ ë³´ê³ ì„œ ì‘ì„±</h2>

<form method="post" action="{{ url_for('report.submit_report') }}">
  <p><strong>ì´ë¦„:</strong> {{ user.name }}</p>
  <p><strong>ì§ê¸‰:</strong> {{ user.position }}</p>

  <label for="week">ì£¼ì°¨ ì„ íƒ:</label>
  <select name="week" id="week" required>
    {% for w in weeks %}
      <option value="{{ w }}">{{ w }}</option>
    {% endfor %}
  </select>

  <hr>

  <div id="project-section-container">
    <!-- í”„ë¡œì íŠ¸ ì„¹ì…˜ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
  </div>

  <button type="button" onclick="addProjectSection()">+ í”„ë¡œì íŠ¸ ì¶”ê°€</button>

  <hr>

  <h3>ğŸ“… ê°œì¸ ì¼ì •</h3>
  <div id="schedule-container">
    <!-- ê°œì¸ ì¼ì •ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
  </div>
  <button type="button" onclick="addSchedule()">+ ì¼ì • ì¶”ê°€</button>

  <br><br>
  <button type="submit">ì œì¶œ</button>
  <a href="{{ url_for('dashboard.dashboard') }}"><button type="button">ì·¨ì†Œ</button></a>
</form>

<script>
let projectCount = 0;
let scheduleCount = 0;

function addProjectSection() {
  const projectList = {{ projects|tojson }};
  const container = document.getElementById("project-section-container");

  const div = document.createElement("div");
  div.classList.add("project-section");
  div.innerHTML = `
    <hr>
    <label>í”„ë¡œì íŠ¸ ì„ íƒ</label>
    <select name="projects[${projectCount}][project_id]" required>
      ${projectList.map(p => `<option value="${p.id}">${p.project_name} (${p.location})</option>`).join("")}
    </select><br>

    <label>ì§„í–‰ìƒí™© *</label><br>
    <textarea name="projects[${projectCount}][progress]" required></textarea><br>

    <label>íŠ¹ì´ì‚¬í•­</label><br>
    <textarea name="projects[${projectCount}][project_issues]"></textarea><br>

    <label>ì˜ì—…ì§€ì› ì‚¬í•­</label><br>
    <textarea name="projects[${projectCount}][sales_support]"></textarea><br>

    <label>ê·¸ ì™¸ íŠ¹ì´ì‚¬í•­</label><br>
    <textarea name="projects[${projectCount}][other_note]"></textarea><br>

    <button type="button" onclick="this.parentElement.remove()">âŒ ì‚­ì œ</button>
    <hr>
  `;
  container.appendChild(div);
  projectCount++;
}

function addSchedule() {
  const container = document.getElementById("schedule-container");

  const div = document.createElement("div");
  div.innerHTML = `
    <label>êµ¬ë¶„</label>
    <select name="schedules[${scheduleCount}][category]">
      <option value="ì¶œì¥">ì¶œì¥</option>
      <option value="ì™¸ê·¼">ì™¸ê·¼</option>
      <option value="íœ´ê°€">íœ´ê°€</option>
      <option value="íœ´ì¼ê·¼ë¬´">íœ´ì¼ê·¼ë¬´</option>
    </select><br>

    <label>ì´ë¦„</label><input name="schedules[${scheduleCount}][person]" required><br>
    <label>ì¥ì†Œ</label><input name="schedules[${scheduleCount}][location]" required><br>
    <label>ì‹œì‘ì¼</label><input type="date" name="schedules[${scheduleCount}][start_date]" required><br>
    <label>ì¢…ë£Œì¼</label><input type="date" name="schedules[${scheduleCount}][end_date]" required><br>
    <label>ë¹„ê³ </label><textarea name="schedules[${scheduleCount}][description]"></textarea><br>

    <button type="button" onclick="this.parentElement.remove()">âŒ ì‚­ì œ</button>
    <hr>
  `;
  container.appendChild(div);
  scheduleCount++;
}
</script>
{% endblock %}
